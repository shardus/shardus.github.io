<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spam a network of nodes | Developer Docs</title>
    <meta name="description" content="Shardus Documentation Developer Docs">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.5a5d7c89.css" as="style"><link rel="preload" href="/assets/js/app.00bf7fce.js" as="script"><link rel="preload" href="/assets/js/2.3fd0cf3c.js" as="script"><link rel="preload" href="/assets/js/30.c288473d.js" as="script"><link rel="prefetch" href="/assets/js/10.c8f90647.js"><link rel="prefetch" href="/assets/js/11.94268391.js"><link rel="prefetch" href="/assets/js/12.72e03446.js"><link rel="prefetch" href="/assets/js/13.ef2570b2.js"><link rel="prefetch" href="/assets/js/14.90f948c7.js"><link rel="prefetch" href="/assets/js/15.d1ab9f27.js"><link rel="prefetch" href="/assets/js/16.c3c3afde.js"><link rel="prefetch" href="/assets/js/17.11d93fa5.js"><link rel="prefetch" href="/assets/js/18.805f0b18.js"><link rel="prefetch" href="/assets/js/19.64845a7b.js"><link rel="prefetch" href="/assets/js/20.395bbe02.js"><link rel="prefetch" href="/assets/js/21.060e90c4.js"><link rel="prefetch" href="/assets/js/22.69ee7234.js"><link rel="prefetch" href="/assets/js/23.730f4a89.js"><link rel="prefetch" href="/assets/js/24.e9661cf2.js"><link rel="prefetch" href="/assets/js/25.b88ed052.js"><link rel="prefetch" href="/assets/js/26.0a46c1b0.js"><link rel="prefetch" href="/assets/js/27.d1a5d31e.js"><link rel="prefetch" href="/assets/js/28.b03d88a5.js"><link rel="prefetch" href="/assets/js/29.926bb12f.js"><link rel="prefetch" href="/assets/js/3.d41181b0.js"><link rel="prefetch" href="/assets/js/31.d4e4aa7d.js"><link rel="prefetch" href="/assets/js/32.b4459487.js"><link rel="prefetch" href="/assets/js/33.3a0ede7d.js"><link rel="prefetch" href="/assets/js/34.86c50212.js"><link rel="prefetch" href="/assets/js/35.89be3532.js"><link rel="prefetch" href="/assets/js/36.09e568d9.js"><link rel="prefetch" href="/assets/js/37.16092d15.js"><link rel="prefetch" href="/assets/js/38.b486685c.js"><link rel="prefetch" href="/assets/js/39.d5eba328.js"><link rel="prefetch" href="/assets/js/4.bdc95c51.js"><link rel="prefetch" href="/assets/js/40.f134f176.js"><link rel="prefetch" href="/assets/js/41.2edff556.js"><link rel="prefetch" href="/assets/js/42.49878b4e.js"><link rel="prefetch" href="/assets/js/43.d361b248.js"><link rel="prefetch" href="/assets/js/44.4e0cbe5a.js"><link rel="prefetch" href="/assets/js/45.97751687.js"><link rel="prefetch" href="/assets/js/46.567954e6.js"><link rel="prefetch" href="/assets/js/47.ac9ca5d5.js"><link rel="prefetch" href="/assets/js/48.e64957d7.js"><link rel="prefetch" href="/assets/js/49.1cdf48ac.js"><link rel="prefetch" href="/assets/js/5.70dbfd4e.js"><link rel="prefetch" href="/assets/js/50.a66c1e36.js"><link rel="prefetch" href="/assets/js/51.3b91b6e9.js"><link rel="prefetch" href="/assets/js/52.9176ffa0.js"><link rel="prefetch" href="/assets/js/53.e7bf447f.js"><link rel="prefetch" href="/assets/js/54.44e77f2a.js"><link rel="prefetch" href="/assets/js/55.be25ed52.js"><link rel="prefetch" href="/assets/js/56.2d408352.js"><link rel="prefetch" href="/assets/js/57.7741f961.js"><link rel="prefetch" href="/assets/js/58.b6af1112.js"><link rel="prefetch" href="/assets/js/6.e910ed1d.js"><link rel="prefetch" href="/assets/js/7.6d6a826f.js"><link rel="prefetch" href="/assets/js/8.a3f31b66.js"><link rel="prefetch" href="/assets/js/9.0a5314d4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5a5d7c89.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Developer Docs" class="logo"> <span class="site-name can-hide">Developer Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Installation</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Main Concepts</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/source/main-concepts/shardus-cli-tool/shardus-cli-tool.html" class="sidebar-heading clickable"><span>Shardus CLI Tools</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/source/main-concepts/application-fundamentals/application-fundamentals.html" class="sidebar-heading clickable"><span>Application Fundementals</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/source/main-concepts/building-a-poc-app/general.html" class="sidebar-heading clickable"><span>Building a PoC App</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/source/main-concepts/poc-to-production/poc-to-production.html" class="sidebar-heading clickable"><span>Poc To Production</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/source/main-concepts/spamming-the-network/spamming-the-network.html" class="sidebar-heading clickable open"><span>Spamming The Network</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/source/main-concepts/spamming-the-network/spam-a-network-of-nodes.html" class="active sidebar-link">Spam a network of nodes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/source/main-concepts/spamming-the-network/spam-a-network-of-nodes.html#createaccounts" class="sidebar-link">createAccounts</a></li><li class="sidebar-sub-header"><a href="/source/main-concepts/spamming-the-network/spam-a-network-of-nodes.html#maketxgenerator" class="sidebar-link">makeTxGenerator</a></li><li class="sidebar-sub-header"><a href="/source/main-concepts/spamming-the-network/spam-a-network-of-nodes.html#getseednodes" class="sidebar-link">getSeedNodes</a></li><li class="sidebar-sub-header"><a href="/source/main-concepts/spamming-the-network/spam-a-network-of-nodes.html#spamtxs" class="sidebar-link">spamTxs</a></li></ul></li><li><a href="/source/main-concepts/spamming-the-network/spam-a-single-node.html" class="sidebar-link">Spam a single node</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SDK Reference</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/source/support-and-feedback/raise-an-issue-on-gitlab.html" class="sidebar-link">Support and Feedback</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spam-a-network-of-nodes-on-shardus"><a href="#spam-a-network-of-nodes-on-shardus" class="header-anchor">#</a> Spam a network of nodes on Shardus</h1> <p>Spamming a network of nodes on shardus gets a bit more complicated. It requires our spam client to aquire a list of node ip addresses and ports from the seed node server, and rapidly generate transactions.</p> <p>Start by creating a CLI command to spam the network with any given transaction type</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>vorpal
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span>
    <span class="token string">&quot;spam transactions &lt;type&gt; &lt;accounts&gt; &lt;count&gt; &lt;tps&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;spams the network with &lt;type&gt; transactions &lt;count&gt; times, with &lt;account&gt; number of accounts, at &lt;tps&gt; transactions per second&quot;</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> accounts <span class="token operator">=</span> <span class="token function">createAccounts</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>accounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> txs <span class="token operator">=</span> <span class="token function">makeTxGenerator</span><span class="token punctuation">(</span>accounts<span class="token punctuation">,</span> args<span class="token punctuation">.</span>count<span class="token punctuation">,</span> args<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> seedNodes <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSeedNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ports <span class="token operator">=</span> seedNodes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">url</span> <span class="token operator">=&gt;</span> url<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">spamTxs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      txs<span class="token punctuation">,</span>
      rate<span class="token operator">:</span> args<span class="token punctuation">.</span>tps<span class="token punctuation">,</span>
      ports<span class="token operator">:</span> ports<span class="token punctuation">,</span>
      saveFile<span class="token operator">:</span> <span class="token string">&quot;spam-test.json&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Done spamming...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>This command will allow us to spam <code>count</code> transactions of whatever <code>type</code> of transaction we pass in, using <code>account</code> number of accounts, at a rate of <code>tps</code> transactions per second.</p></blockquote> <p>Now lets implement the 4 functions we defined in the spam command to make it work</p> <h2 id="createaccounts"><a href="#createaccounts" class="header-anchor">#</a> createAccounts</h2> <p>This function needs to create an arbitrary number of accounts, each with their own keypairs in order to be able to sign the transactions. Define two more functions here, one for creating a single account, and one that uses the single <code>createAccount</code> function to create an arbitrary number of accounts, <code>createAccounts</code>. You will need to import the <code>crypto</code> module in order to generate keypairs.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;shardus-crypto-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">crypto</span><span class="token punctuation">(</span><span class="token string">&quot;64f152869ca2d473e4ba64ab53f49ccdb2edae22da192c126850970e788af347&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token parameter">keys <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">generateKeypair</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    address<span class="token operator">:</span> keys<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    keys
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createAccounts</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Create an empty array of size (num) and map it to a list of account keypairs</span>
  <span class="token keyword">const</span> accounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">account</span> <span class="token operator">=&gt;</span> <span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> accounts<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="maketxgenerator"><a href="#maketxgenerator" class="header-anchor">#</a> makeTxGenerator</h2> <p>Create a function called <code>makeTxGenerator</code> that implements a generator function called <code>buildGenerator</code>. <code>buildGenerator</code> should loop through all the accounts passed in, generate &quot;create&quot; transactions so they have tokens to transfer, and then generate whatever transaction &quot;type&quot; was passed in. Use a while loop to iterate through each account until the number of transactions generated is equivalent to the <code>total</code> value passed in by the CLI command.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeTxGenerator</span><span class="token punctuation">(</span><span class="token parameter">accounts<span class="token punctuation">,</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">buildGenerator</span><span class="token punctuation">(</span><span class="token parameter">txBuilder<span class="token punctuation">,</span> accounts<span class="token punctuation">,</span> total<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> account1<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> account2<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>total <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Keep looping through all available accounts as the srcAcct</span>
      account1 <span class="token operator">=</span> accounts<span class="token punctuation">[</span>total <span class="token operator">%</span> accounts<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// Pick some other random account as the tgtAcct</span>
      offset <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>accounts<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      account2 <span class="token operator">=</span> accounts<span class="token punctuation">[</span><span class="token punctuation">(</span>total <span class="token operator">+</span> offset<span class="token punctuation">)</span> <span class="token operator">%</span> accounts<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">// Return a create tx to add funds to the srcAcct</span>
      <span class="token keyword">yield</span> <span class="token function">txBuilder</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> to<span class="token operator">:</span> account1<span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;transfer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token keyword">yield</span> <span class="token function">txBuilder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token operator">:</span> <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">from</span><span class="token operator">:</span> account1<span class="token punctuation">,</span>
            to<span class="token operator">:</span> account2<span class="token punctuation">,</span>
            amount<span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            body<span class="token operator">:</span> <span class="token string">&quot;spam1234&quot;</span><span class="token punctuation">,</span>
            timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            handle<span class="token operator">:</span> account1
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">yield</span> <span class="token function">txBuilder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token operator">:</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">from</span><span class="token operator">:</span> account1<span class="token punctuation">,</span>
            to<span class="token operator">:</span> account2<span class="token punctuation">,</span>
            message<span class="token operator">:</span> message<span class="token punctuation">,</span>
            amount<span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token string">&quot;toll&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token keyword">yield</span> <span class="token function">txBuilder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token operator">:</span> <span class="token string">&quot;toll&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">from</span><span class="token operator">:</span> account1<span class="token punctuation">,</span>
            toll<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            amount<span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Type must be `transfer`, `message`, or `toll`&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      total<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>total <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">buildGenerator</span><span class="token punctuation">(</span>buildTx<span class="token punctuation">,</span> accounts<span class="token punctuation">,</span> total<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  generator<span class="token punctuation">.</span>length <span class="token operator">=</span> total<span class="token punctuation">;</span>
  <span class="token keyword">return</span> generator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now create the <code>buildTx</code> function that we passed into <code>buildGenerator</code>, inside of <code>makeTxGenerator</code>. Build the actual transaction according to the type, and what needs to be sent with that type of transaction, then sign the transaction with the account keys passed in (&quot;from&quot; and &quot;to&quot;).</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">buildTx</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> type<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> to<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> message<span class="token punctuation">,</span> toll <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> actualTx<span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;create&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      actualTx <span class="token operator">=</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> type<span class="token punctuation">,</span>
        srcAcc<span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        tgtAcc<span class="token operator">:</span> to<span class="token punctuation">.</span>address<span class="token punctuation">,</span>
        amount<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">,</span>
        timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&quot;transfer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      actualTx <span class="token operator">=</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> type<span class="token punctuation">,</span>
        srcAcc<span class="token operator">:</span> <span class="token keyword">from</span><span class="token punctuation">.</span>address<span class="token punctuation">,</span>
        timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        tgtAcc<span class="token operator">:</span> to<span class="token punctuation">.</span>address<span class="token punctuation">,</span>
        amount<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      actualTx <span class="token operator">=</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> type<span class="token punctuation">,</span>
        srcAcc<span class="token operator">:</span> <span class="token keyword">from</span><span class="token punctuation">.</span>address<span class="token punctuation">,</span>
        tgtAcc<span class="token operator">:</span> to<span class="token punctuation">.</span>address<span class="token punctuation">,</span>
        message<span class="token operator">:</span> message<span class="token punctuation">,</span>
        amount<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">,</span>
        timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&quot;toll&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      actualTx <span class="token operator">=</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> type<span class="token punctuation">,</span>
        srcAcc<span class="token operator">:</span> <span class="token keyword">from</span><span class="token punctuation">.</span>address<span class="token punctuation">,</span>
        toll<span class="token operator">:</span> toll<span class="token punctuation">,</span>
        amount<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">,</span>
        timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Type must be `transfer`, `message`, or `toll`&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    crypto<span class="token punctuation">.</span><span class="token function">signObj</span><span class="token punctuation">(</span>actualTx<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">.</span>keys<span class="token punctuation">.</span>secretKey<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">.</span>keys<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    crypto<span class="token punctuation">.</span><span class="token function">signObj</span><span class="token punctuation">(</span>actualTx<span class="token punctuation">,</span> to<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>secretKey<span class="token punctuation">,</span> to<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> actualTx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="getseednodes"><a href="#getseednodes" class="header-anchor">#</a> getSeedNodes</h2> <p>Create a function called <code>getSeedNodes</code> that grabs a list of node addresses from the seednode server. Make a <code>GET</code> request to the URL where your seedNode server is running at the route <code>/api/seednodes</code>.</p> <blockquote><p>Since i'm testing this on a network locally in my CLI spam command, I only need to map the port numbers returned from this function, however this will return an array of seedNode objects in this form:
<code>[{&quot;ip&quot;: &quot;127.0.0.1&quot;, &quot;port&quot;: 9001 }, {&quot;ip&quot;: &quot;127.0.0.1&quot;, &quot;port&quot;: 9002 } ...]</code>
So you can use the data from this seed node server grab the ip addresses of the nodes as well.</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getSeedNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:4000/api/seednodes</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> seedNodes <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">return</span> seedNodes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="spamtxs"><a href="#spamtxs" class="header-anchor">#</a> spamTxs</h2> <p>Now implement the <code>spamTxs</code> function that actually spams the network with transactions. Additionally, you should implement write streams if you wish to log the sent transactions to a file for debugging purposes.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">spamTxs</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  txs<span class="token punctuation">,</span>
  rate<span class="token punctuation">,</span>
  ports <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  saveFile <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  verbose <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>ports<span class="token punctuation">)</span><span class="token punctuation">)</span> ports <span class="token operator">=</span> <span class="token punctuation">[</span>ports<span class="token punctuation">]</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Spamming </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ports<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;ports&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;port&quot;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ports<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
      txs<span class="token punctuation">.</span>length <span class="token operator">?</span> txs<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">txs at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> TPS...</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> writeStream <span class="token operator">=</span> saveFile
    <span class="token operator">?</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> saveFile<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> port<span class="token punctuation">;</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> tx <span class="token keyword">of</span> txs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span> writeStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    port <span class="token operator">=</span> ports<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> ports<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">sendTx</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> port<span class="token punctuation">,</span> verbose<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">_sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> rate<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span> writeStream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Done spamming&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> writeStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;finish&quot;</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Wrote spammed txs to '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>saveFile<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Lastly, let's implement the <code>sendTx</code> and <code>_sleep</code> functions used by <code>sendTxs</code>.
<code>sendTx</code> will just make a <code>POST</code> request to the server.
<code>_sleep</code> will ensure the number of transactions sent doesn't exceed the <code>tps</code> argument passed in by the CLI.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sendTx</span><span class="token punctuation">(</span><span class="token parameter">tx<span class="token punctuation">,</span> port <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> verbose <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tx<span class="token punctuation">.</span>sign<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tx <span class="token operator">=</span> <span class="token function">buildTx</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sending tx to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/inject</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>verbose<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Got response:&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_sleep</span><span class="token punctuation">(</span><span class="token parameter">ms <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/source/main-concepts/poc-to-production/stopping-spam-with-pow.html" class="prev">
        Stopping Spam with PoW
      </a></span> <span class="next"><a href="/source/main-concepts/spamming-the-network/spam-a-single-node.html">
        Spam a single node
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.00bf7fce.js" defer></script><script src="/assets/js/2.3fd0cf3c.js" defer></script><script src="/assets/js/30.c288473d.js" defer></script>
  </body>
</html>
